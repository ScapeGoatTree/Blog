
<!DOCTYPE html>
<html lang="zh-cmn-hans">
<head>
    <meta charset="UTF-8">
    <title>Luogu SP7001 - Lyc's Blog</title>
    <link rel="icon" href="https://lyc-blog.herokuapp.com/usr/themes/Fantasy/static/img/icon.png" sizes="192x192"/>
    <link href="https://lyc-blog.herokuapp.com/usr/themes/Fantasy/static/kico.css" rel="stylesheet" type="text/css"/>
    <link href="https://lyc-blog.herokuapp.com/usr/themes/Fantasy/static/fantasy.css" rel="stylesheet" type="text/css"/>
    <link href="https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1"/>
    <meta name="description" content="题目描述一共T组数据，每组数据一个整数n，表示有一个大小为$n^3$的正方体。求：在(0,0,0)位置能够看到多少个不被遮挡的点(i,j,k)特别地，i，j，k均为整数。思路不妨从二维的情况开始..." />
<meta name="generator" content="Typecho 1.2/18.10.23" />
<meta name="template" content="Fantasy" />
<link rel="alternate" type="application/rss+xml" title="Luogu SP7001 &raquo; Lyc's Blog &raquo; RSS 2.0" href="https://lyc-blog.herokuapp.com/index.php/feed/archives/3/" />
<link rel="alternate" type="application/rdf+xml" title="Luogu SP7001 &raquo; Lyc's Blog &raquo; RSS 1.0" href="https://lyc-blog.herokuapp.com/index.php/feed/rss/archives/3/" />
<link rel="alternate" type="application/atom+xml" title="Luogu SP7001 &raquo; Lyc's Blog &raquo; ATOM 1.0" href="https://lyc-blog.herokuapp.com/index.php/feed/atom/archives/3/" />
<script type="text/javascript">
(function () {
    window.TypechoComment = {
        dom : function (id) {
            return document.getElementById(id);
        },
    
        create : function (tag, attr) {
            var el = document.createElement(tag);
        
            for (var key in attr) {
                el.setAttribute(key, attr[key]);
            }
        
            return el;
        },

        reply : function (cid, coid) {
            var comment = this.dom(cid), parent = comment.parentNode,
                response = this.dom('respond-post-3'), input = this.dom('comment-parent'),
                form = 'form' == response.tagName ? response : response.getElementsByTagName('form')[0],
                textarea = response.getElementsByTagName('textarea')[0];

            if (null == input) {
                input = this.create('input', {
                    'type' : 'hidden',
                    'name' : 'parent',
                    'id'   : 'comment-parent'
                });

                form.appendChild(input);
            }

            input.setAttribute('value', coid);

            if (null == this.dom('comment-form-place-holder')) {
                var holder = this.create('div', {
                    'id' : 'comment-form-place-holder'
                });

                response.parentNode.insertBefore(holder, response);
            }

            comment.appendChild(response);
            this.dom('cancel-comment-reply-link').style.display = '';

            if (null != textarea && 'text' == textarea.name) {
                textarea.focus();
            }

            return false;
        },

        cancelReply : function () {
            var response = this.dom('respond-post-3'),
            holder = this.dom('comment-form-place-holder'), input = this.dom('comment-parent');

            if (null != input) {
                input.parentNode.removeChild(input);
            }

            if (null == holder) {
                return true;
            }

            this.dom('cancel-comment-reply-link').style.display = 'none';
            holder.parentNode.insertBefore(response, holder);
            return false;
        }
    };
})();
</script>
<script type="text/javascript">
(function () {
    var event = document.addEventListener ? {
        add: 'addEventListener',
        triggers: ['scroll', 'mousemove', 'keyup', 'touchstart'],
        load: 'DOMContentLoaded'
    } : {
        add: 'attachEvent',
        triggers: ['onfocus', 'onmousemove', 'onkeyup', 'ontouchstart'],
        load: 'onload'
    }, added = false;

    document[event.add](event.load, function () {
        var r = document.getElementById('respond-post-3'),
            input = document.createElement('input');
        input.type = 'hidden';
        input.name = '_';
        input.value = (function () {
    var _OgJ3 = //'G3'
'9a1'+'11b'//'UWB'
+//'u'
'58'+//'xz'
'1'+//'As8'
'26'+//'y'
'0'+'873'//'A'
+'e'//'G'
+''///*'XZb'*/'XZb'
+''///*'4Jy'*/'4Jy'
+'b6'//'Rcm'
+'845'//'BKn'
+//'D'
'37d'+//'TUc'
'b'+'f4'//'DJ3'
+//'iC8'
'faa'+'b'//'G'
+/* 'yN'//'yN' */''+//'J9'
'J9'+'w'//'w'
+'b'//'J6e'
, _H1AsQIT = [[31,33],[31,32]];
    
    for (var i = 0; i < _H1AsQIT.length; i ++) {
        _OgJ3 = _OgJ3.substring(0, _H1AsQIT[i][0]) + _OgJ3.substring(_H1AsQIT[i][1]);
    }

    return _OgJ3;
})();

        if (null != r) {
            var forms = r.getElementsByTagName('form');
            if (forms.length > 0) {
                function append() {
                    if (!added) {
                        forms[0].appendChild(input);
                        added = true;
                    }
                }
            
                for (var i = 0; i < event.triggers.length; i ++) {
                    var trigger = event.triggers[i];
                    document[event.add](trigger, append);
                    window[event.add](trigger, append);
                }
            }
        }
    });
})();

</head>
<body>
<aside>
    <nav class="side-nav">
        <a href="https://lyc-blog.herokuapp.com/">首页</a>
        <a href="https://lyc-blog.herokuapp.com/index.php/start-page.html">关于</a>    </nav>
    <nav class="side-action">
        <div class="search-btn"></div>
    </nav>
    <div class="side-window">
        <div class="side-wrap">
            <form class="search-form" method="post">
                <input type="text" name="s" placeholder="搜索什么？">
            </form>
            <div class="side-category color-bar">
                <a href="https://lyc-blog.herokuapp.com/index.php/category/default/">默认分类</a>            </div>
        </div>
    </div>
</aside>
<header>
    <div class="toggle"></div>
    <div class="wrap min">
        <h1 class="headline"><span>Lyc's Blog</span></h1>
    </div>
</header><main>
    <div class="wrap min">
        <section class="board">
            <div class="post-title">
                <h2>Luogu SP7001</h2>
                <div class="post-meta">
                    <time class="date">2018-11-18</time>
                    <span class="category"><a href="https://lyc-blog.herokuapp.com/index.php/category/default/">默认分类</a></span>
                    <span class="comments">0 条评论</span>
                    <span class="edit"><a href="https://lyc-blog.herokuapp.com/admin/write-post.php?cid=3" target="_blank">编辑</a></span>
                </div>
            </div>
            <article class="post-content">
                <h1>题目描述</h1><p>一共T组数据，每组数据一个整数n，表示有一个大小为$n^3$的正方体。求：在(0,0,0)位置能够看到多少个不被遮挡的点(i,j,k)</p><p>特别地，i，j，k均为整数。</p><h3>思路</h3><p>不妨从二维的情况开始考虑。事实上，这道题目的确有二维形式。</p><p><a href="http://poj.org/problem?id=3090">POJ3090 Visible Lattice Points</a></p><p>不妨这样想，点(i,j)为什么会被看到？是因为它和(0,0)的连线上面没有点了。我们知道这条直线的斜率为$$\frac{j-0}{i-0}=\frac{j}{i}$$<br>这说明j和i的最大公因数为1，i，j互质。</p><p>那么这道题就成了对于每一个$s&lt;=n$，求得所有小于等于s的与s互质的数字的个数，而这就是求欧拉函数<br>$\varphi(s)$的值，乘以2，再去除被计算两次的点(1,1).<br>所以$ans=2*\sum_{s=1}^{n}\varphi(s)-1$，利用线性筛求得n以内所有欧拉函数的值即可。</p><h3>升维打击！</h3><p>多了一维，思路保持不变。对于所有的i，j，k，我们要找出一共有多少种情况，使得$gcd(i,j,k)=1$.我们可以这样表达这个公式:</p><ul><li>$g(n)=\sum_{i=1}^{n}\sum_{j=1}^{n}\sum_{k=1}^{n}pd(i,j,k)$</li><li>其中当且仅当$gcd(i,j,k)=1$时$pd(i,j,k)=1$,否则为0.</li></ul><p>显然，我们可以利用三重循环暴力枚举ijk，再用$log_{2}n$的时间完成gcd，但是在$n=1000000$多组数据的情况下分分钟就T飞了！于是我们来考虑一下新的算法：</p><h3>变换大法+数学<del>乱搞</del></h3><p>如果现在有一个函数$f(x)$,满足如下条件：</p><ul><li>$f(n)=\sum_{i=1}^{N}\sum_{j=1}^{N}\sum_{k=1}^{N}pd(i,j,k)$</li><li>其中当且仅当$gcd(i,j,k)=n$时$pd(i,j,k)=1$,否则为0.</li></ul><p>很容易看出这个函数表示在0-N范围内有多少对公因数为n的三数对。<br>很显然$f(1)$就是我们要求的数值。<br>但是这个函数看起来不好求啊？？</p><p>请看：</p><hr><h2>莫比乌斯反演变换</h2><p>定义：如果有$F(n)=\sum_{d|n}f(d)(d|n$表示d整除n$)$</p><p>那么必然能够得到$f(n)=\sum_{d|n}μ(\frac{n}{d})F(d)$</p><p>这被称作莫比乌斯反演公式，其中$μ()$函数代表莫比乌斯函数。关于这个函数，我们需要知道的是：<br>如果给出一个合数p的标准分解式：$p=p_1^{α_1}p_2^{α_2}...p_m^{α_m}$<br>那么就有</p><p>$μ(p)=\begin{cases} 1 &amp;&amp; {p=1}\\ (-1)^m &amp;&amp; each         α=1\\ 0 &amp;&amp;otherwise\end{cases}$</p><p>这是莫比乌斯函数的定义公式</p><hr><h3>定义函数，进行反演</h3><p>经验告诉我们，$f(n)$的选取常常与等于有关，而$F(n)$的选取通常与整除有关。<br>这里，我们定义：</p><ul><li>$f(n)=\sum_{i=1}^{N}\sum_{j=1}^{N}\sum_{k=1}^{N}pd(i,j,k)$</li><li>其中当且仅当$gcd(i,j,k)=n$时$pd(i,j,k)=1$,否则为0.</li></ul><p>那么相应地，我们这样定义大F(n)</p><ul><li>$F(n)=\sum_{i=1}^{N}\sum_{j=1}^{N}\sum_{k=1}^{N}pd(i,j,k)$</li><li>其中当且仅当${n}\equiv 0\mod{gcd(i,j,k)} $时$pd(i,j,k)=1$,否则为0.那么我们知道$gcd(i,j,k)$必须是n的因数。</li></ul><p>好了，很容易推导出：$F(n)=\sum_{d|n}f(d)$</p><p>莫比乌斯反演变换后得到$f(n)=\sum_{d|n}μ(\frac n d)F(d).$</p><p>接下来我们对这个式子做一点处理。因为要求得$f(1)$的值，我们令$n=1$，得到$f(1)=\sum_{d=1}^Nμ(d)F(d)=\sum_{d}μ(d)\sum_{i=1}^{N}\sum_{j=1}^{N}\sum_{k=1}^{N}pd(i,j,k).$</p><p>对右边部分处理。不妨设$i=ad,j=bd,k=cd$,那么d一定是从1到N的。对于每一个d，abc都只能是1-[N/d]中的某一个，因此可得$F(d)={[\frac N d]}^3$.如果是二维，同理可得$F(d)={[\frac N d]}^2$</p><p>考虑到N的因数只有$\sqrt N$个，我们可以在线性筛莫比乌斯函数的时候预处理莫比乌斯函数的前缀和。利用整除分块，对$[\frac N d]$相同的d进行组合处理.至此，本题得解。最终的答案应该是立体处理+三个平面的处理（分别是$x=0, y=0, z=0$）+$(0,1,1),(1,1,0),(1,0,1)$三个点.</p><p>$ans=\sum_{d=1}^Nμ(d)({[\frac N d]}^2([\frac N d]+1))+3$</p><p>总的时间复杂度为$O(T\sqrt N)$,不用整除分块是$O(TN)$,本来是过不掉的，但是<del>数据似乎太水了</del></p><pre><code>#include&lt;bits/stdc++.h&gt;
using namespace std;
inline int re()
{
    int n=0,k=1;
    char c=getchar();
    while(c&gt;'9'||c&lt;'0'){if(c=='-') k=-1; c=getchar();    }
    while(c&lt;='9'&amp;&amp;c&gt;='0'){n=(n&lt;&lt;1)+(n&lt;&lt;3)+(c^48); c=getchar();    }
    return n*k;
}
bool pd[10010010];
int prime[10010010];
int miu[10010010];
int he[10010010];
inline int shai(int n)
{
    int tot=0;
    memset(pd,true,sizeof(pd));
    miu[1]=1;
    he[1]=1;
    for(int i=2;i&lt;=n;i++)
    {
        if(pd[i])
        {
            prime[++tot]=i;
            miu[i]=-1;
        }
        for(int j=1;j&lt;=tot&amp;&amp;i*prime[j]&lt;=n;j++)
        {
            pd[i*prime[j]]=false;
            if(i%prime[j]==0){miu[i*prime[j]]=0;break;}
            else miu[i*prime[j]]=-miu[i];
        }
        he[i]=he[i-1]+miu[i];
    }
    return tot;
}
int n,T;
int main()
{
    T=re();
    shai(1001000);
    long long ans=0;
    while(T--)
    {
        n=re();
        ans=3ll;
        long long l=1,r;
        while(l&lt;=n)
        {
            long long k=n/l;
            r=n/k;
            ans+=(he[r]-he[l-1])*k*k*(k+3);
            l=r+1;
        }        
        printf(&quot;%lld\n&quot;,ans);
    }
    return 0;
}</code></pre>            </article>
        </section>
        
        <section class="board">
            <h3>参与讨论</h3>
                        <div id="respond-post-3">
                <form class="comment-form" id="respond-post-3" action="https://lyc-blog.herokuapp.com/index.php/archives/3/comment" id="comment-form" role="form">
                    <div class="cancel-reply"><a id="cancel-comment-reply-link" href="https://lyc-blog.herokuapp.com/index.php/archives/3/#respond-post-3" rel="nofollow" style="display:none" onclick="return TypechoComment.cancelReply();">取消回复</a></div>
                    <figure class="comment-avatar">
                        <img src="https://secure.gravatar.com/avatar/59720e33607e8fcc91ccac160c8e9c2e?s=150&amp;r=X&amp;d=mm"/>
                    </figure>
                    <fieldset>
                        <textarea rows="2" name="text" placeholder="说下感想吧！" required></textarea>
                        <p class="logined"><a href="https://lyc-blog.herokuapp.com/admin/profile.php">admin</a>，欢迎回来！不是你？<a href="https://lyc-blog.herokuapp.com/index.php/action/logout" title="登出">登出</a></p>
                        <button class="btn submit" type="submit"></button>
                    </fieldset>
                </form>
            </div>
    <p class="no-comment">还没有评论呢！</p>
        </section>    </div>
</main>

<footer>
    <section class="foot-widget">
        <div class="wrap min">
            <div class="row">
                <div class="col-m-4">
                    <h3>最新文章：</h3>
                    <ul>
                        <li><a href="https://lyc-blog.herokuapp.com/index.php/archives/3/" target="_blank">Luogu SP7001</a></li>                    </ul>
                </div>
                <div class="col-m-4">
                    <h3>时光机：</h3>
                    <ul>
                        <li><a href="https://lyc-blog.herokuapp.com/index.php/2018/11/" rel="nofollow" target="_blank">2018 年 11 月</a></li>                    </ul>
                </div>
                <div class="col-m-4">
                    <h3>最近评论：</h3>
                    <ul>
                                                                    </ul>
                </div>
            </div>
        </div>
    </section>
    <section class="foot-copyright">
        <p>&copy; 2018 <a href="https://lyc-blog.herokuapp.com/">Lyc's Blog</a>. All Rights Reserved. Theme By <a href="https://github.com/Dreamer-Paul/Fantasy" target="_blank" rel="nofollow">Fantasy</a>.</p>
    </section>
</footer>

<script src="https://lyc-blog.herokuapp.com/usr/themes/Fantasy/static/kico.js"></script>
<script src="https://lyc-blog.herokuapp.com/usr/themes/Fantasy/static/fantasy.js"></script>

</body>
</html>